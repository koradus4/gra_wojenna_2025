# PLAN ROZWOJU AI GENERA≈ÅA - WERSJA 1.0

## üìå CEL G≈Å√ìWNY
Stworzenie uczciwego i inteligentnego AI Genera≈Ça, kt√≥ry podejmuje decyzje ekonomiczne w oparciu o analizƒô stanu w≈Çasnych dow√≥dc√≥w i ich jednostek, dzia≈ÇajƒÖc w ramach tych samych zasad co gracz ludzki.

## üìÅ PLIKI PROJEKTU WYKORZYSTANE W PLANIE

### **G≈Å√ìWNE PLIKI IMPLEMENTACJI:**

**ai/ai_general.py** - G≈Ç√≥wny plik AI Genera≈Ça
- *Dlaczego:* Zawiera logikƒô decyzyjnƒÖ AI, metody zakup√≥w, bud≈ºetu
- *U≈ºycie:* Dodanie dostƒôpu do VP, Key Points, poprawki logiki decide_action()

**engine/engine.py** - Rdze≈Ñ gry z danymi strategicznymi  
- *Dlaczego:* Zawiera key_points_state, player management, kontroler g≈Ç√≥wny
- *U≈ºycie:* Dostƒôp do Key Points, stanu gry dla AI

**engine/player.py** - ZarzƒÖdzanie graczami i ich danymi
- *Dlaczego:* Zawiera victory_points, economic_points, dow√≥dc√≥w gracza
- *U≈ºycie:* Dostƒôp AI do VP, PE, listy dow√≥dc√≥w

**core/zwyciestwo.py** - System warunk√≥w zwyciƒôstwa
- *Dlaczego:* ZarzƒÖdza VP, max_turns, warunkami ko≈Ñca gry
- *U≈ºycie:* AI analizuje etap gry i stan VP dla strategii

**core/tura.py** - ZarzƒÖdzanie turami
- *Dlaczego:* TurnManager z current_turn, fazy gry
- *U≈ºycie:* AI okre≈õla etap gry (wczesny/≈õredni/p√≥≈∫ny)

**core/ekonomia.py** - System ekonomiczny  
- *Dlaczego:* ZarzƒÖdzanie punktami ekonomicznymi, Key Points
- *U≈ºycie:* AI analizuje dochody z Key Points

### **PLIKI POMOCNICZE:**

**core/unit_factory.py** - Fabryka jednostek
- *Dlaczego:* Tworzenie ≈ºeton√≥w, szablony jednostek
- *U≈ºycie:* AI u≈ºywa do zakup√≥w programowych

**engine/token.py** - Definicje ≈ºeton√≥w
- *Dlaczego:* Struktura danych ≈ºeton√≥w, combat value, paliwo  
- *U≈ºycie:* AI analizuje stan jednostek dow√≥dc√≥w

**engine/board.py** - ZarzƒÖdzanie mapƒÖ
- *Dlaczego:* Pozycje ≈ºeton√≥w, hex_grid, lokalizacje
- *U≈ºycie:* AI analizuje pozycje strategiczne

**gui/panel_gracza.py** - Panel gracza z logikƒÖ ekonomicznƒÖ
- *Dlaczego:* Metody budget allocation, UI economiczny
- *U≈ºycie:* AI wykorzystuje te same metody co human

**gui/panel_generala.py** - GUI Human Genera≈Ça z pe≈ÇnƒÖ logikƒÖ
- *Dlaczego:* Zawiera metody: toggle_support_sliders(), open_token_shop(), update_economy()
- *U≈ºycie:* AI musi replikowaƒá te EXACT funkcjonalno≈õci bez GUI

**gui/token_shop.py** - Sklep zakupu jednostek Human Genera≈Ça
- *Dlaczego:* Pe≈Çna logika zakup√≥w: wyb√≥r typu, rozmiaru, wsparcia, transportu
- *U≈ºycie:* AI musi u≈ºywaƒá identycznej logiki zakup√≥w programowo

**gui/zarzadzanie_punktami_ekonomicznymi.py** - Przydzielanie PE dow√≥dcom
- *Dlaczego:* Suwaki i logika alokacji punkt√≥w miƒôdzy dow√≥dc√≥w
- *U≈ºycie:* AI replika tej logiki dla sprawiedliwego podzia≈Çu PE

## üîç ANALIZA STANU (CO AI MUSI WIEDZIEƒÜ)

### Analiza per dow√≥dca:
- **≈ªetony dow√≥dcy:** lista wszystkich jednostek ka≈ºdego dow√≥dcy
- **Stan paliwa per dow√≥dca:** % ≈ºeton√≥w z niskim paliwem (<30%)
- **Combat value per dow√≥dca:** ≈õredni combat value ≈ºeton√≥w dow√≥dcy
- **Typ jednostek per dow√≥dca:** piechota, artyleria, zaopatrzenie, etc.
- **Lokalizacja dow√≥dcy:** pozycja wzglƒôdem wrog√≥w i key points
- **Historia strat per dow√≥dca:** trendy ubytk√≥w w poprzednich turach

### Analiza globalna:
- **Dostƒôpne punkty ekonomiczne genera≈Ça**
- **Status VP:** nasze_vp vs wrogie_vp  
- **Etap gry:** aktualna_tura / (max_tur / 3)
- **Key Points:** lokalizacje i kontrola (w≈Çasne/wrogie/neutralne)
- **Prognoza dochod√≥w:** z key points w kolejnych turach

## üîç ANALIZA HUMAN GENERA≈ÅA (WZORZEC DO REPLIKACJI)

### **EXACT FUNKCJONALNO≈öCI HUMAN GENERA≈ÅA:**

**1. ALOKACJA PUNKT√ìW** (`toggle_support_sliders()` w panel_generala.py):
- Otwiera modal z suwakami dla ka≈ºdego dow√≥dcy
- Podzia≈Ç max punkt√≥w miƒôdzy dow√≥dc√≥w z kontrolƒÖ limitu
- Synchronizacja: `dowodca.economy.economic_points += przydzielone`
- Odejmowanie z puli: `self.ekonomia.subtract_points(suma)`

**2. ZAKUP JEDNOSTEK** (`open_token_shop()` ‚Üí `TokenShop.buy_unit()`):
- Wyb√≥r: nacja, typ jednostki, rozmiar, wsparcie, transport
- Generowanie unikalnego ID: `nowy_{typ}_{rozmiar}__{dowodca_id}_{label}_{timestamp}`
- Tworzenie: token.json + token.png w folderze assets/tokens/nowe_dla_{dowodca_id}/
- Odejmowanie koszt√≥w: `self.ekonomia.subtract_points(cena)`
- Callback: `on_purchase_callback()` ‚Üí `refresh_points()`

**3. RAPORT EKONOMICZNY** (`update_economy()`):
- Wy≈õwietla: PE genera≈Ça, punkty specjalne, PE ka≈ºdego dow√≥dcy
- ≈πr√≥d≈Ço danych: `self.ekonomia.get_points()` + `dowodca.economy.get_points()`

**AI MUSI MIEƒÜ TE SAME MO≈ªLIWO≈öCI - BEZ GUI:**
- Te same metody alokacji/zakupu
- Te same ≈∫r√≥d≈Ça danych (ekonomia, dow√≥dcy)
- Te same koszty i ograniczenia
- Identyczny workflow tworzenia jednostek

## ‚öôÔ∏è OPCJE DZIA≈ÅANIA AI GENERA≈ÅA

**ZACHOWANE 100% - BEZ ZMIAN:**

1. **ALOKACJA PUNKT√ìW** dow√≥dcom
   - Identyczne zasady jak human genera≈Ç
   - Te same mo≈ºliwo≈õci przekazywania PE
   - Pe≈Çny parytet bez oszukiwania

2. **ZAKUP ≈ªETON√ìW** dla dow√≥dc√≥w  
   - Te same mo≈ºliwo≈õci co human genera≈Ç
   - Identyczne szablony i koszty jednostek
   - Bez oszukiwania, pe≈Çen parytet

3. **KOMBINACJA** alokacji + zakup√≥w
   - Podzia≈Ç bud≈ºetu miƒôdzy opcje (20-40-40)
   - Adaptacja % wed≈Çug sytuacji
   - Bez utraty funkcjonalno≈õci

4. **HOLD** (oszczƒôdzanie)
   - W sytuacjach niepewno≈õci

**NOWE DANE STRATEGICZNE:**
- AI teraz **widzi VP** i mo≈ºe dostosowaƒá % bud≈ºetu
- AI teraz **widzi Key Points** i mo≈ºe priorytetyzowaƒá kontrolƒô
- AI teraz **zna etap gry** i mo≈ºe planowaƒá d≈Çugoterminowo

## üß† ZASADY DECYZYJNE AI

### üìä DANE WEJ≈öCIOWE (Co AI musi wiedzieƒá - PARYTET Z HUMAN GENERA≈ÅEM)

**Victory Points (VP) - PE≈ÅNY DOSTƒòP:**
- [x] W≈Çasne VP (`player.victory_points`)
- [x] VP przeciwnika (suma VP wrogiej nacji)
- [x] Historia VP (`player.vp_history`) - trend zwyciƒôstwa
- [x] VP za eliminacjƒô = cena zniszczonej jednostki

**Key Points - PE≈ÅNY DOSTƒòP:**
- [x] Lokalizacje wszystkich Key Points (`game_engine.key_points_state`)
- [x] Warto≈õƒá ka≈ºdego Key Point (ekonomiczna korzy≈õƒá)
- [x] Kto kontroluje kt√≥re punkty (w≈Çasne/wrogie/neutralne)
- [x] Historia dochod√≥w z Key Points

**Informacje o grze - PE≈ÅNY DOSTƒòP:**
- [x] Aktualna tura (`game_engine.turn` lub `turn_manager.current_turn`)
- [x] Maksymalna liczba tur (`victory_conditions.max_turns`)
- [x] Pozosta≈Çy czas: `(max_turns - current_turn)`
- [x] Faza gry: `current_turn / (max_turns / 3)`

**Analiza dow√≥dc√≥w - ZACHOWANE:**
- [x] ≈ªetony per dow√≥dca z paliwo/combat value
- [x] Jednostki dow√≥dcy (bez zmian)
- [x] Priorytety dow√≥dc√≥w (bez zmian)

### üí∞ PODSTAWOWE ZASADY BUD≈ªETU (20-40-40)

**BAZOWA STRATEGIA:**
- **20% REZERWA** - zawsze na nieprzewidziane sytuacje
- **40% ALOKACJA** - punkty ekonomiczne dla dow√≥dc√≥w (paliwo, regeneracja)
- **40% ZAKUPY** - nowe ≈ºetony dla dow√≥dc√≥w

### üîÑ ADAPTACJA CO TURƒò NA PODSTAWIE:

**1. ANALIZA DOW√ìDC√ìW:**
- **Paliwo:** % jednostek ka≈ºdego dow√≥dcy z niskim paliwem (<30%)
- **Combat Value:** ≈õredni combat value ≈ºeton√≥w ka≈ºdego dow√≥dcy
- **Zapotrzebowanie:** kt√≥ry dow√≥dca najbardziej potrzebuje wsparcia

**2. ETAP GRY** (wszystkie tury √∑ 3):
- **POCZƒÑTEK** (1/3 tur): 20-40-40 ‚Üí focus na rozw√≥j
- **≈öRODEK** (2/3 tur): adaptacja ‚Üí walka o pozycje
- **KONIEC** (3/3 tur): adaptacja ‚Üí decydujƒÖce ruchy

**3. STATUS VP:**
- **WYGRYWAMY VP:** wiƒôcej na alokacjƒô (ochrona)
- **PRZEGRYWAMY VP:** wiƒôcej na zakupy (agresja)
- **REMIS VP:** standardowe 20-40-40

### üìä KONKRETNE ADAPTACJE BUD≈ªETU:

**KRYZYS PALIWA** (>30% jednostek dow√≥dcy bez paliwa):
- 15% rezerwa, **70% alokacja**, 15% zakupy

**KO≈ÉC√ìWKA + PRZEGRYWAMY VP:**
- 10% rezerwa, 25% alokacja, **65% zakupy** (desperacja!)

**KO≈ÉC√ìWKA + WYGRYWAMY VP:**
- 30% rezerwa, **55% alokacja**, 15% zakupy (ochrona!)

**≈öRODEK + R√ìWNE VP:**
- 20% rezerwa, 35% alokacja, **45% zakupy** (ekspansja!)

### üéÆ PRIORYTETY STRATEGICZNE

**1. SURVIVAL** (najwy≈ºszy priorytet):
- Uzupe≈Çnij paliwo je≈õli >30% jednostek sparali≈ºowanych
- Kup Supply (Z) je≈õli brak zaopatrzenia
- Zabezpiecz genera≈Ça przed eliminacjƒÖ

**2. VP HUNTING** (gdy przegrywamy):
- Priorytet jednostek ofensywnych (artyleria, pancerne)
- Agresywne pozycjonowanie
- Wiƒôcej % na zakupy ni≈º uzupe≈Çnienia

**3. KEY POINTS CONTROL**:
- Oceniaj warto≈õƒá ekonomicznƒÖ vs ryzyko
- Priorytet dla najbogatszych punkt√≥w
- Mobilne jednostki do szybkiego zajmowania

**4. VP PROTECTION** (gdy wygrywamy):
- Obronne pozycjonowanie
- Wiƒôcej % na uzupe≈Çnienia
- Unikaj niepotrzebnych walk

### ‚öñÔ∏è SYSTEM PODEJMOWANIA DECYZJI

**ALGORYTM CO TURƒò:**

**KROK 1 - ZBIERANIE DANYCH STRATEGICZNYCH:**
```
// NOWE: Pe≈Çny dostƒôp do danych strategicznych
own_vp = sum(vp for p in players if p.nation == ai_nation)
enemy_vp = sum(vp for p in players if p.nation != ai_nation)
vp_status = own_vp - enemy_vp

current_turn = game_engine.turn
max_turns = victory_conditions.max_turns
turns_left = max_turns - current_turn
game_phase = current_turn / (max_turns / 3)

key_points_controlled = analyze_key_points_control(game_engine.key_points_state)
```

**KROK 2 - ANALIZA DOW√ìDC√ìW (ZACHOWANE):**
```
FOR ka≈ºdy_dow√≥dca:
  - paliwo_ratio = ≈ºetony_z_niskim_paliwem / wszystkie_≈ºetony
  - combat_avg = ≈õredni_combat_value_≈ºeton√≥w
  - potrzeba_wsparcia = (paliwo_ratio * 0.6) + (combat_avg_loss * 0.4)
```

**KROK 3 - OKRE≈öLENIE STRATEGII:**
```
IF max(paliwo_ratio_dow√≥dc√≥w) > 0.3: "KRYZYS_PALIWA"
ELIF game_phase > 2.0 AND vp_status < 0: "DESPERACJA" 
ELIF game_phase > 2.0 AND vp_status > 0: "OCHRONA"
ELIF game_phase > 1.0: "EKSPANSJA"
ELSE: "ROZW√ìJ"
```

**KROK 4 - WYKONANIE (ZACHOWANE 100%):**
1. Zastosuj % bud≈ºetu wed≈Çug strategii
2. **ALOKUJ** punkty dow√≥dcom wed≈Çug priorytet√≥w
3. **KUP** ≈ºetony dla dow√≥dc√≥w z najwiƒôkszymi brakami
4. **KOMBINUJ** oba podej≈õcia wed≈Çug potrzeb

### Zasady uczciwo≈õci:
- AI dzia≈Ça w ramach tych samych regu≈Ç co gracz ludzki
- Brak bonus√≥w, skr√≥t√≥w ani oszukiwania
- Pe≈Çny parytet mo≈ºliwo≈õci z human genera≈Çem

## üöÄ PLAN IMPLEMENTACJI

### FAZA 1: Rozbudowa analizy stanu ‚úÖ **UKO≈ÉCZONE**
- [x] **Udoskonalenie zbierania danych o jednostkach** - analyze_units() z pe≈ÇnƒÖ analizƒÖ per dow√≥dca
- [x] **≈öledzenie trend√≥w (straty, zu≈ºycie paliwa)** - struktura _unit_analysis z metrykami
- [x] **Analiza zagro≈ºe≈Ñ i mo≈ºliwo≈õci** - nowa metoda analyze_strategic_situation() 
- [x] **Dostƒôp do VP, Key Points, fazy gry** - pe≈Çna implementacja w analyze_strategic_situation()

### FAZA 2: Rozbudowa logowania i audytu ‚úÖ **UKO≈ÉCZONE**
- [x] **Log ekonomii AI** - pe_start/allocated/spent/remaining per tura ‚úÖ log_economy_turn()
- [x] **Log Key Points** - warto≈õƒá/kontrola/doch√≥d per tura per punkt ‚úÖ log_keypoints_turn()
- [x] **Weryfikacja PE** - czy poprawnie aktualizowane miƒôdzy turami ‚úÖ w make_turn()
- [x] **Audyt strategii** - analiza decyzji AI w kontek≈õcie sytuacji ‚úÖ log_strategy_decision()

### FAZA 3: Rozbudowa opcji dzia≈Çania ‚úÖ **UKO≈ÉCZONE**
- [x] **Implementacja kombinacji zakup√≥w + przydzia≈Çu** ‚úÖ EconAction.COMBO z elastycznym bud≈ºetem
- [x] **Elastyczne % podzia≈Çu bud≈ºetu** ‚úÖ BUDGET_STRATEGIES z adaptacjƒÖ 20-40-40 
- [x] **Uwzglƒôdnienie priorytet√≥w strategicznych** ‚úÖ _determine_strategy() implementuje plan

### FAZA 4: Inteligentne zasady decyzyjne ‚úÖ **UKO≈ÉCZONE**
- [x] **Implementacja ustalonych zasad** ‚úÖ Strategiczny decide_action() zgodny z planem
- [x] **Testowanie r√≥≈ºnych scenariuszy** ‚úÖ 5 strategii: ROZW√ìJ/KRYZYS_PALIWA/DESPERACJA/OCHRONA/EKSPANSJA  
- [x] **Balansowanie agresywno≈õci vs ostro≈ºno≈õci** ‚úÖ Adaptacyjne % bud≈ºetu wed≈Çug sytuacji VP/fazy gry

### FAZA 5: Optymalizacja i testy
- [ ] Testy z graczami ludzkimi
- [ ] Dostrajanie parametr√≥w
- [ ] Dokumentacja ko≈Ñcowa
- [ ] **Weryfikacja log√≥w** - kontrola poprawno≈õci PE i Key Points miƒôdzy turami

## ‚úÖ **IMPLEMENTACJA UKO≈ÉCZONA - GOTOWE DO TEST√ìW**

### üéØ **CO ZOSTA≈ÅO ZAIMPLEMENTOWANE:**

**PE≈ÅNY PARYTET Z HUMAN GENERA≈ÅEM:**
- ‚úÖ Dostƒôp do Victory Points (VP) - w≈Çasne i wrogiego gracza
- ‚úÖ Dostƒôp do Key Points - kontrola, warto≈õƒá, dochody  
- ‚úÖ Dostƒôp do informacji o turze - aktualna/max/faza gry
- ‚úÖ Analiza jednostek per dow√≥dca - paliwo, combat value, typy
- ‚úÖ Identyczne mo≈ºliwo≈õci ekonomiczne (alokacja + zakupy)

**STRATEGICZNE ZASADY DECYZYJNE:**
- ‚úÖ System 20-40-40 z adaptacjƒÖ wed≈Çug sytuacji
- ‚úÖ 5 strategii: ROZW√ìJ/KRYZYS_PALIWA/DESPERACJA/OCHRONA/EKSPANSJA
- ‚úÖ Akcja COMBO - kombinacja alokacji + zakup√≥w
- ‚úÖ Elastyczne % bud≈ºetu wed≈Çug VP, fazy gry, stanu paliwa

**SYSTEM LOGOWANIA I AUDYTU:**
- ‚úÖ Log ekonomii AI per tura (PE start/allocated/spent/remaining)
- ‚úÖ Log Key Points per tura (kontrola/warto≈õƒá/doch√≥d)
- ‚úÖ Log strategii AI (decyzje/zasady/kontekst)
- ‚úÖ Pliki CSV w logs/ai_general/ z timestamps

**ROZBUDOWANE ANALIZY:**
- ‚úÖ analyze_units() - pe≈Çna analiza per dow√≥dca z metrykami
- ‚úÖ analyze_strategic_situation() - VP, Key Points, faza gry
- ‚úÖ _determine_strategy() - implementuje logikƒô z planu

### üöÄ **GOTOWE DO FAZY TESTOWEJ:**
AI Genera≈Ç ma teraz **pe≈Çny parytet** z human genera≈Çem oraz **inteligentne zasady strategiczne** zgodnie z planem. Wszystkie funkcjonalno≈õci sƒÖ zaimplementowane i gotowe do test√≥w!

## üìä METRYKI SUKCESU

**PODSTAWOWE:**
- AI podejmuje sensowne decyzje ekonomiczne
- Nie ma przewagi nad graczem ludzkim (fairplay)
- Reaguje adaptacyjnie na zmieniajƒÖcƒÖ siƒô sytuacjƒô
- Kod jest zrozumia≈Çy i ≈Çatwy do modyfikacji

**LOGOWANIE I AUDYT:**

### üí∞ Log Ekonomii AI (per tura):
```csv
timestamp,turn,nation,pe_start,pe_allocated,pe_spent_purchases,pe_total_used,pe_remaining,strategy_used,vp_own,vp_enemy,vp_status
```
- **pe_start** - PE na poczƒÖtku tury
- **pe_allocated** - ile PE rozdano dow√≥dcom
- **pe_spent_purchases** - ile PE wydano na zakupy
- **pe_total_used** - suma wydatk√≥w (allocated + purchases)
- **pe_remaining** - ile PE zosta≈Ço na koniec tury
- **strategy_used** - u≈ºyta strategia (KRYZYS_PALIWA, DESPERACJA, etc.)

### üó∫Ô∏è Log Key Points (per tura):
```csv
timestamp,turn,hex_id,kp_type,kp_value_start,kp_controlled_by,kp_income_generated,kp_value_end
```
- **kp_value_start** - warto≈õƒá Key Point na poczƒÖtku tury
- **kp_controlled_by** - kto kontroluje (Polska/Niemcy/Neutral)
- **kp_income_generated** - ile PE wygenerowa≈Ç w tej turze
- **kp_value_end** - warto≈õƒá Key Point na ko≈Ñcu tury

### üéØ Cel logowania:
- **Weryfikacja PE** - sprawdzenie czy PE sƒÖ poprawnie aktualizowane miƒôdzy turami
- **Audyt Key Points** - ≈õledzenie dochod√≥w i kontroli punkt√≥w strategicznych
- **Debug strategii** - analiza czy AI podejmuje sensowne decyzje
- **Balans gry** - kontrola czy AI nie ma nieuczciwych korzy≈õci

## üìù LOG ZMIAN
- **20.08.2025** - Utworzenie planu, sekcja na przysz≈Çe ustalenia zasad
- **22.08.2025** - Dodanie wymaga≈Ñ pe≈Çnego parytetu z human genera≈Çem (VP, Key Points, tury)
- **22.08.2025** - Dodanie wymaga≈Ñ szczeg√≥≈Çowego logowania PE i Key Points per tura

---
*Dokument roboczy - bƒôdzie aktualizowany w miarƒô ustalania szczeg√≥≈Ç√≥w implementacji*
